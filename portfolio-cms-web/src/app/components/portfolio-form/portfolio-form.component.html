<div class="form-container">
  <div class="form-header">
    <h1>{{ isEditMode ? ('portfolioForm.editTitle' | translate) : ('portfolioForm.createTitle' | translate) }}</h1>
    @if (!isEditMode) {
      <button type="button" class="btn-generate" (click)="openGenerateModal()">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="7 10 12 15 17 10"></polyline>
          <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
        {{ 'portfolioForm.generateBtn' | translate }}
      </button>
    }
  </div>

  @if (loading) {
    <div class="loading">{{ 'portfolioForm.loading' | translate }}</div>
  }
  
  @if (error && !showGenerateModal) {
    <div class="error">{{ error }}</div>
  }

  @if (!loading) {
    <form [formGroup]="portfolioForm" (ngSubmit)="onSubmit()" class="portfolio-form">
      <div class="form-group">
        <label for="title">{{ 'portfolioForm.title' | translate }} <span class="required">*</span></label>
        <input 
          type="text" 
          id="title" 
          formControlName="title" 
          [class.invalid]="isFieldInvalid('title')"
          [placeholder]="'portfolioForm.titlePlaceholder' | translate">
        @if (isFieldInvalid('title')) {
          <div class="error-message">
            {{ getErrorMessage('title') }}
          </div>
        }
      </div>

      <div class="form-group">
        <label for="subtitle">{{ 'portfolioForm.subtitle' | translate }} <span class="required">*</span></label>
        <input 
          type="text" 
          id="subtitle" 
          formControlName="subtitle" 
          [class.invalid]="isFieldInvalid('subtitle')"
          [placeholder]="'portfolioForm.subtitlePlaceholder' | translate">
        @if (isFieldInvalid('subtitle')) {
          <div class="error-message">
            {{ getErrorMessage('subtitle') }}
          </div>
        }
      </div>

      <div class="form-group">
        <label for="bio">{{ 'portfolioForm.bio' | translate }} <span class="required">*</span></label>
        <textarea 
          id="bio" 
          formControlName="bio" 
          rows="5"
          [class.invalid]="isFieldInvalid('bio')"
          [placeholder]="'portfolioForm.bioPlaceholder' | translate"></textarea>
        @if (isFieldInvalid('bio')) {
          <div class="error-message">
            {{ getErrorMessage('bio') }}
          </div>
        }
      </div>

      <div class="form-group">
        <label for="template">{{ 'portfolioForm.template' | translate }} <span class="required">*</span></label>
        <div class="template-selector">
          @for (template of templates; track template.id) {
            <label class="template-option" [class.selected]="portfolioForm.get('template')?.value === template.id">
              <input 
                type="radio" 
                [value]="template.id" 
                formControlName="template">
              <div class="template-card">
                <h3>{{ template.name }}</h3>
                <p>{{ template.description }}</p>
              </div>
            </label>
          }
        </div>
        @if (isFieldInvalid('template')) {
          <div class="error-message">
            {{ getErrorMessage('template') }}
          </div>
        }
      </div>

      <div class="form-group checkbox-group">
        <label>
          <input type="checkbox" formControlName="isPublished">
          <span>{{ 'portfolioForm.isPublished' | translate }}</span>
        </label>
      </div>

      <div class="form-group checkbox-group">
        <label>
          <input type="checkbox" formControlName="featuredBlogsEnabled">
          <span>{{ 'portfolioForm.featuredBlogs' | translate }}</span>
        </label>
      </div>

      <div class="info-box">
        <p><strong>{{ 'common.note' | translate }}:</strong> {{ 'portfolioForm.note' | translate }}</p>
      </div>

      <div class="form-actions">
        <button type="button" class="btn-cancel" (click)="cancel()">{{ 'portfolioForm.cancel' | translate }}</button>
        <button type="submit" class="btn-submit" [disabled]="loading">
          {{ isEditMode ? ('portfolioForm.update' | translate) : ('portfolioForm.create' | translate) }}
        </button>
      </div>
    </form>
  }
</div>

<!-- Generate Portfolio Modal -->
@if (showGenerateModal) {
  <div class="modal-overlay" (click)="closeGenerateModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ 'portfolioForm.generateTitle' | translate }}</h2>
        <button type="button" class="close-btn" (click)="closeGenerateModal()">Ã—</button>
      </div>

      <div class="modal-body">
        <p>{{ 'portfolioForm.generateDesc' | translate }}</p>

        <div class="generate-options">
          <!-- PDF Upload -->
          <div class="generate-section">
            <h3>{{ 'portfolioForm.uploadResume' | translate }}</h3>
            <div class="file-upload">
              <input 
                type="file" 
                id="pdfFile" 
                accept=".pdf"
                (change)="onFileSelected($event)"
                #fileInput>
              <label for="pdfFile" class="upload-label">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                  <polyline points="14 2 14 8 20 8"></polyline>
                  <line x1="16" y1="13" x2="8" y2="13"></line>
                  <line x1="16" y1="17" x2="8" y2="17"></line>
                  <polyline points="10 9 9 9 8 9"></polyline>
                </svg>
                @if (selectedFile) {
                  <span class="file-name">{{ selectedFile.name }}</span>
                } @else {
                  <span>{{ 'portfolioForm.clickSelectPdf' | translate }}</span>
                }
              </label>
            </div>
          </div>

          <div class="divider">
            <span>{{ 'portfolioForm.or' | translate }}</span>
          </div>

          <!-- LinkedIn URL -->
          <div class="generate-section">
            <h3>{{ 'portfolioForm.linkedInUrl' | translate }}</h3>
            <input 
              type="url" 
              [(ngModel)]="linkedInUrl"
              placeholder="https://www.linkedin.com/in/your-profile"
              class="linkedin-input">
          </div>
        </div>

        @if (error) {
          <div class="modal-error">{{ error }}</div>
        }
      </div>

      <div class="modal-footer">
        <button type="button" class="btn-cancel" (click)="closeGenerateModal()" [disabled]="generating">
          {{ 'portfolioForm.cancel' | translate }}
        </button>
        <button type="button" class="btn-primary" (click)="generatePortfolio()" [disabled]="generating || (!selectedFile && !linkedInUrl)">
          @if (generating) {
            <span class="spinner"></span>
            {{ 'portfolioForm.generating' | translate }}
          } @else {
            {{ 'portfolioForm.generate' | translate }}
          }
        </button>
      </div>
    </div>
  </div>
}
